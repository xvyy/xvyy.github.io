---
bg: photo056.jpg
layout: post
title: SSH
crawlertitle: SSH
summary: SSH & SSH
date: 2021-07-28 23:45:00 +0800
categories: tech
tags : ssh
author: vpromise
---

*SSH 多次连接*

---

- [前言](#前言)
- [实现](#实现)
- [SSH config](#ssh-config)

## 前言

中心这边的VPN只能连新川办公室内网，虽然可以访问AiStation，但是没法访问本地的两台服务器，测试发现这边服务器地址为10.91.\*\*.\*\*，内网ip是10.92.\*\*.\*\*，VPN连接内网分配地址是92的，无法访问本地服务器，但是中心这边的机器虽然连的是92，却可以访问91的服务器，突发奇想做两次跳转连接，就可以访问服务器了，测试发现确实可行。具体连接示意图如下图所示：

![两次SSH连接示意图](https://i.loli.net/2021/07/29/NMceHIZi9fXwJPm.png)
## 实现

图示已经展示了整个实现的步骤：
1. 连接VPN接入内网
2. 第一次SSH，登录办公室机器
3. 第二次SSH，从办公室机器登录服务器
   
## SSH config

两次登录还是有点麻烦，而且只能终端操作了，如果使用VSCode的SSH Remote来远程还是不方便，其实VS Code也可以两次SSH直连服务器，只需要改一下ssh的config文件就好，如下示例
```
Host M2
  HostName **.**.**.** # M2的ip
  User m2_user # M2用户名
  
Host M3
  Hostname **.**.**.** # M3的ip
  ProxyJump M2 # 关键 实现跳转
  User m3_user # M3用户名
```
